version: 3

vars:
  SCRIPTS_DIR:
    sh: realpath ./scripts
  LOCAL_BIN:
    sh: realpath ./bin

tasks:
  build:
    desc: Copy shell scripts to bin
    silent: false
    sources:
      - "{{ .SCRIPTS_DIR }}/*"
    generates:
      - "{{ .LOCAL_BIN }}/*"
    cmds:
      - for: sources
        cmd: cp {{ .ITEM }} {{ .LOCAL_BIN }}/{{ base .ITEM }}

  lint:
    desc: Lint shell scripts
    cmds:
      - |
        if command -v shellcheck >/dev/null 2>&1; then
          # Only lint bash scripts (shellcheck doesn't support zsh)
          find scripts -type f -exec file {} \; | grep -i "Bourne-Again" | cut -d: -f1 | xargs -r shellcheck -S error
        else
          echo "shellcheck not installed. Install with: brew install shellcheck"
        fi